# 微服务概述

## 微服务特点

1. 微服务单元按照业务来划分
2. 通过HTTP协议通信
3. 使用独立的数据库
4. 自动化部署
5. 服务集中化管理
6. 分布式架构
7. 熔断机制

# Eureka 服务注册与发现

## CAP

- CAP原则又称CAP定理，指的是在一个分布式系统中，一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance）
- CAP 原则指的是，这三个要素最多只能同时实现两点，不可能三者兼顾
- P是必须的，故组合只能是AP或者CP
- 优先级：P > A > C
- Zookeeper保证CP，Eureka保证AP

# Ribbon 负载均衡

> 客户端的负载均衡（LB，Load Balancer）

## LB的分类

### 集中式LB

- 在服务的消费方和提供方之间使用独立的LB设施（可以是软件Nginx也可以是硬件F5）

### 进程内LB

- 将LB逻辑集中到消费方，消费方从服务注册中心获知有哪些服务器可以使用

## LB算法

1. RoundRobinRule 轮询

2. RandomRule 随机

3. AvailabilityFilteringRule 过滤多次访问故障跳闸的、并发连接超过阈值的服务，然后对余下的服务轮询

4. WeightedResponseTimeRule 根据平均响应时间计算所有服务的权重，响应时间越短权重越大

5. RetryRule 轮询、重试

6. BestAvailableRule 过滤多次访问故障服务，选择一个并发量最小的

7. ZoneAvoidanceRule，默认算法，复合判断服务所在区域的性能与可用性

8. 自定义算法

   ```
   ！自定义配置类不能放在@ComponentScan所扫描的当前包以及子包下，否则该配置类就会被所有的Ribbon客户端所共享，即达不到定制化的目的
   ```

# Feign 负载均衡

> 声明式WebService客户端，使用Feign能让编写WebService客户端更简单。通过接口+注解的方式调用微服务

- Feign整合了Ribbon

# Hystrix 断路器

> 复杂的分布式系统应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免地失败

- 链式调用（扇出容易造成雪崩）
- 断路器本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似与熔断保险丝），向调用方返回一个符合预期的、可处理的备选响应，而不是长时间阻塞或者抛出异常，从而避免故障在分布式系统之中的蔓延

## 服务熔断（服务端）

> 服务不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点微服务的调用，快速返回错误信息，当检测到服务恢复后恢复调用链路

## 服务降级（客户端）

# Zuul 路由网关

- 将外部请求转发到具体的微服务实例上

# Config 分布式配置中心

