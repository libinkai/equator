# 概述

## OS发展过程

1. 人工操作方式
2. 脱（主）机输入输出方式
3. 单道批处理系统
4. 多道批处理系统
5. 分时系统
6. 实时系统

## 操作系统的基本特性

### 并发性

- 并行指的是两个或者多个事件在同一时刻发生，而并发性指的是两个或者多个事件在同一时间间隔内发生
- 进程是指在系统中能独立运行并作为资源分配的基本单位
- 通常在一个进程中可以包含若干个线程，它们可以利用进程所拥有的资源。在引入线程的 OS 中，通常都是把进程作为分配资源的基本单位，而把线程作为独立运行和独立调度的基本单位

### 共享性

- 系统中的资源可供内存中多个并发执行的进程(线程)共同使用，相应地，把这种资源共同使用称为资源共享，或称为资源复用
- 互斥访问（打印机）与共享访问（磁盘）

### 虚拟技术

- 时分复用技术
  - 虚拟处理机（时间片切换）
  - 虚拟设备技术（将一台物理 I/O 设备虚拟为多台逻辑上的 I/O 设备）
- 空分复用技术
  - 虚拟磁盘（分区）
  - 虚拟存储器（虚拟内存）

### 异步性

- 进程是以人们不可预知的速度向前推进

## 主要功能

### 处理机管理

- 进程控制
- 进程同步
- 进程通信
- 调度（作业调度+进程调度）

### 存储器管理

- 内存分配
- 内存保护
- 地址映射
- 内存扩充

### 设备管理

- 缓冲管理
- 设备分配
- 设备处理

### 文件管理

- 文件储存空间管理
- 目录管理
- 文件读写管理和保护

### OS与用户之间的接口

- 用户接口
- 程序接口

# 进程管理

## 基本概念

### 程序顺序执行及其特征

1. 顺序性
2. 封闭性
3. 可再现性

### 程序的并发执行及其特征

1. 间断性
2. 非封闭性
3. 不可再现性

### 进程的特征

1. 结构特征：PCB
2. 动态性：生命周期
3. 并发性
4. 独立性
5. 异步性

### 进程的状态

1. 创建状态（分配PCB，系统填写了进程信息，但是还没有进入主存）
2. 活动就绪（拥有除了CPU以外的所需资源）
3. 静止就绪（挂起）
4. 执行状态
5. 活动阻塞
6. 静止阻塞（挂起）
7. 终止（清空PCB）

### 进程控制块

> 用于描述和控制进程的运行，它是进程实体的一部分

- 包含的信息
  - 进程标识符
  - 处理机状态（处理机被中断时，寄存器信息被保存在这里）
  - 进程调度信息（进程状态、优先级、事件）
  - 进程控制信息（程序与数据的地址，同步通信机制、资源清单、链接指针）
- 进程控制块的组织方式
  - 链接方式
  - 索引方式

## 进程控制

- 引起创建进程的事件
  - 用户登录
  - 作业调度
  - 提供服务
  - 应用请求

- 进程创建步骤
  - 获取唯一的进程标识符，申请PCB
  - 分配资源
  - 初始化PCB
  - 将新进程插入就绪队列
- 进程终止步骤
  - 根据进程标识符，从PCB集合读取进程状态
  - 若进程处于执行状态，**递归**终止进程并标记调度标记为真
  - 归还资源
  - 将PCB移出所在队列

## 进程同步

- 制约关系
  - 间接制约：共享资源
  - 直接制约：进程合作
- 临界资源
  - 需要互斥访问，如打印机
- 临界区
  - 进程中访问临界资源的代码区
- 同步机制的原则
  - 空闲让进
  - 忙则等待
  - 有限等待
  - 让权等待（不能进入自己的临界区时，立即放弃处理机）
- 信号量机制
  - 整型信号量
  - 记录型信号量
  - AND型信号量（要么获取多个资源，要么一个都不要）
  - 信号量集（AND型的拓展）
- 管程
  - 代表共享资源的数据结构，以及由对该共享数据结构实施操作的一组过程所组成的资源管理程序
  - 条件变量：抽象的数据结构，一个条件变量有一个链表（等待队列）

## 经典进程的同步问题

- 生产者消费者问题
  - 利用记录型信号量解决
  - 利用AND信号量解决
  - 利用管程解决

- 哲学家就餐问题
  - 利用记录型信号量解决
  - 利用AND信号量机制解决
- 读者写者问题
  - 利用记录型信号量解决
  - 利用信号量机制解决

## 进程通信

- 进程通信的类型
  - 共享存储器系统
    - 共享数据结构
    - 共享存储区
  - 消息传递系统
  - 管程通信

## 线程

- 把线程作为调度和分派的基本单位，而进程作为资源拥有的基本单位
- 实现方式
  - 内核支持线程
  - 用户级线程（OS不感知）
    - 运行时系统
    - 内核控制线程
  - 组合方式

# 处理机调度与死锁

## 处理机调度的层次

### 高级调度

> 长程调度

- 作业：包含了程序和数据以及作业说明书，系统根据该说明书来对程序的运行进行控制
- 作业步
- 作业流
- 作业控制块JCB
- 作业调度

### 低级调度

> 进程调度或者短程调度，调度对象是进程或者内核级线程

- 功能
  - 保存现场
  - 按照某种算法选取进程
  - 把处理器分配给进程
- 基本机制
  - 排队器
  - 分派器
  - 上下文切换机制
- 进程调度方式
  - 非抢占式：一旦把处理机分配给某进程后，不管它要运行多长时间，都一直让它运行下去，决不会因为时钟中断等原因而抢占正在运行进程的处理机，也不允许其它进程抢占已经分配给它的处理机
  - 抢占式：允许调度程序根据某种原则去暂停某个正在执行的进程，将已分配给该进程的处理机重新分配给另一进程
    - 优先权原则
    - 短作业优先原则
    - 时间片原则

### 中级调度

> 中程调度，对象是进程，中级调度实际上就是存储器管理中的对换功能

- 那些暂时不能运行的进程不再占用宝贵的内存资源，而将它们调至外存上去等待，把此时的进程状态称为就绪驻外存状态或挂起状态。当这些进程重又具备运行条件且内存又稍有空闲时，由中级调度来决定把外存上的那些又具备运行条件的就绪进程重新调入内存，并修改其状态为就绪状态，挂在就绪队列上等待进程调度

## 调度队列模型

- 仅有进程调度的模型（就绪队列+阻塞队列）
- 具有高级和低级调度的模型（后备队列+优先级就绪队列+多个阻塞队列）
- 三级调度模型（挂起队列）

## 调度准则

- 面向用户
  - 周转时间短
  - 响应时间快
  - 截至时间的保证
  - 优先级准则
- 面向系统
  - 吞吐量高
  - CPU利用率高
  - 资源的平衡利用

## 调度算法

### 先来先服务

- 有利于计算密集型作业

### 短作业优先

- 选择估计运行时间短的作业

### 高优先级优先调度算法

- 优先级调度

### 高响应比优先调度算法

- 优先级 = （等待时间+要求服务时间）/要求服务时间

### 时间片轮转法

### 多级反馈队列调度算法

- 多个就绪队列，根据优先级分配时间片

## 实时调度

## 产生死锁的原因以及必要条件

- 原因
  - 竞争资源（可剥夺性资源以及非可剥夺性资源）
  - 进程间推进算法顺序非法
- 必要条件
  - 互斥条件
  - 请求和保持条件
  - 不剥夺条件
  - 环路等待条件
- 处理死锁的方法
  - 预防，破坏其必要条件
  - 避免，资源分配过程中避免进入不安全的状态
  - 检测并清除

## 预防死锁

- 银行家算法

## 死锁的检测与解除

- 保存有关资源的请求和分配信息
- 提供死锁检测方法

# 存储器管理

## 存储器的层次

- 金字塔型：寄存器->主存->辅存

## 程序的装入与链接

- 在多道程序环境下，要使程序运行，必须先为之创建进程。而创建进程的第一件事，便是将程序和数据装入内存
- 程序到进程
  - 编译：源程序->目标模块（编译器）
  - 链接：目标模块->装入模块（链接程序）
  - 装入（装入程序）
- 程序的装入
  - 绝对装入
  - 可重定位装入方式
  - 状态装入方式
- 程序的链接
  - 静态链接
  - 装入时动态链接
  - 运行时动态链接

---

> 以下为作业在内存中的分配管理

## 连续分配方式

- 单一连续分配（内存分为系统区与用户区）
- 固定分区分配
- 动态分区分配（空闲分区表+空闲分区链）
  - 首次适应算法（找到为止）
  - 循环记忆算法（从上一次）
  - 最佳适配算法（分区链有序）
  - 最坏适应算法（全局扫描找最大的切割）
  - 快速适应算法（分类搜索法，按照常用容量创建多个空闲分区链表）
- 伙伴系统
- 哈希算法
- 可重定位分区分配（使用重定位寄存器存放程序数据在内存中的起始位置，重定位时使用相对地址+重定位寄存器）
- 对换：把内存中暂时不能运行的进程或者暂时不用的程序和数据调出到外存上，以便腾出足够的内存空间，再把已具备运行条件的进程或进程所需要的程序和数据调入内存
  - 进程：整体对换
  - 页、段：部分对换

## 基本分页储存管理方式

### 页面与页表

- 分页存储管理是将一个进程的逻辑地址空间分成若干个大小相等（通常为512B或者8KB）的片，称为页面或**页**，并为各页从0开始加以编号
- 相应地，也把内存空间分成与页面相同大小的若干个存储块，称为**（物理）块**或**页框**（frame），也同样为它们加以编号
- 在为进程分配内存时，以块为单位将进程中的若干个页分别装入到多个可以不相邻接的物理块中
- 系统又为每个进程建立了一张页面映像表，简称**页表**。在进程地址空间内的所有页(0～n)，依次在页表中有一页表项，其中记录了相应页在内存中对应的物理块号。页表的作用是实现从页号到物理块号的地址映射

### 地址变换机构

- 页表大多驻留在内存中。在系统中只设置一个**页表寄存器**PTR(Page-Table Register)，在其中存放页表在内存的始址和页表的长度。平时，进程未执行时，页表的始址和页表长度存放在本进程的PCB中。当调度程序调度到某进程时，才将这两个数据装入页表寄存器中
- 快表：由于页表是存放在内存中的，这使CPU在每存取一个数据时，都要两次访问内存。为了提高地址变换速度，可在地址变换机构中增设一个具有并行查寻能力的特殊高速缓冲寄存器，又称为“联想寄存器”(Associative Memory)，或称为“快表”，在IBM系统中又取名为TLB(Translation Lookaside Buffer)，用以存放当前访问的那些页表项
- 二级页表以及多级页表：解决逻辑地址空间非常大的问题

## 基本分段储存管理方式

### 段与段表

- 在分段存储管理方式中，作业的地址空间被划分为若干个段，每个段定义了一组逻辑信息。为了实现简单起见，通常可用一个段号来代替段名，每个段都从0开始编址，并采用一段连续的地址空间
- 在系统中为每个进程建立一张段映射表，简称“段表”。每个段在表中占有一个表项，其中记录了该段在内存中的起始地址(又称为“基址”)和段的长度

### 地址变换机构

- 段表寄存器

## 段页式存储管理方式

- 段页式系统的基本原理，是分段和分页原理的结合，即先将用户程序分成若干个段，再把每个段分成若干个页，并为每一个段赋予一个段名

## 虚拟存储器

- 常规存储器管理方式
  - 一次性
  - 驻留性
- 局部性原理
  - 时间：热点指令
  - 空间：热点内存区域
- 实现
  - 分页请求系统
    - 请求分页的页表机制
    - 缺页中断机构
    - 地址变换机构
    - 配套软件
  - 请求分段系统
    - 请求分段的段表机制
    - 缺段中断机构
    - 地址变换机构
- 虚拟存储器的特征
  - 多次性
  - 对换性
  - 虚拟性

## 请求分页储存管理方式

### 页表机制

- 页号
- 物理块号
- 状态位，标记该页是否已调入内存，程序访问时参考
- 访问字段，本页在一段时间内被访问次数或者未访问次数，页面置换时参考
- 修改位，该页调入内存之后是否被修改过（脏页），页面置换时参考（内存中的每一页都在外存保留了一份副本）
- 外存地址，该页在外存中的地址，通常是物理块号

### 缺页中断机构

- 缺页中断的特点
  - 在指令执行期间产生与处理中断信号而不是在指令执行完毕转入公操作时处理
  - 一条指令执行过程中，有可能有多次缺页中断

### 地址变换机构

- 分页系统地址变换的基础上添加了功能

## 页面置换算法

### 最佳置换算法

- 一种理论上的算法。其所选择的被淘汰页面，将是以后永不使用的，或许是在最长(未来)时间内不再被访问的页面

### 先进先出算法

### 最近最久未使用算法 LRU

- LRU置换算法是选择最近最久未使用的页面予以淘汰。该算法赋予每个页面一个访问字段，用来记录一个页面自上次被访问以来所经历的时间t，当须淘汰一个页面时，选择现有页面中其t值最大的，即最近最久未使用的页面予以淘汰
- 寄存器+栈

### Clock算法

- 为每页设置一位访问位，再将内存中的所有页面都通过链接指针链接成一个循环队列。当某页被访问时，其访问位被置1。置换算法在选择一页淘汰时，只需检查页的访问位。如果是0，就选择该页换出；若为1，则重新将它置0，暂不换出，而给该页第二次驻留内存的机会，再按照FIFO算法检查下一个页面
- 也称为最近未用算法NRU

### 最少使用算法 LFU

- 为在内存中的每个页面设置一个移位寄存器，用来记录该页面被访问的频率

### 页面缓冲算法 PBA

## 请求分段储存管理方式

### 段表机制

- 段名
- 段长
- 段基址
- 存储方式，读、写、读写
- 访问字段，记录被访问次数
- 修改位，是否被修改
- 存在位，是否已调入内存
- **增补位**，是否做过动态增长
- 外存始址，起始盘块号

# 设备管理

## IO系统

### IO设备

- 设备类型
  - 存储设备、输入输出设备（按使用特性）
  - 低速设备：键鼠；中速设备：打印机；高速设备：磁盘（按速度）
  - 块设备：磁盘；字符设备：打印机（按信息交换的单位）
  - 独占设备、共享设备、虚拟设备（按共享属性）
- 设备与控制器之间的接口
  - 数据信号线
  - 控制信号线
  - 状态信号线
- IO通道
- 总线系统

## IO控制方式

### 程序IO方式

> 忙等待方式

### 中断驱动

> 基于中断事件驱动，一个字节中断一次

### 直接存储器访问控制 DMA

- 基于数据块
- 所传输数据直接进入内存
- 仅在一次或者多次数据块的开始与结束和结束时才需要CPU干预

### IO通道控制

- I/O通道方式是DMA方式的发展，它可进一步减少CPU的干预，即把对一个数据块的读(或写)为单位的干预减少为对一组数据块的读(或写)及有关的控制和管理为单位的干预
- 当CPU要完成一组相关的读(或写)操作及有关控制时，只需向I/O通道发送一条I/O指令，以给出其所要执行的通道程序的首址和要访问的I/O设备，通道接到该指令后，通过执行通道程序便可完成CPU指定的I/O任务

## 缓冲管理

- 单缓冲：每当用户进程发出一I/O请求时，操作系统便在主存中为之分配一缓冲区
- 双缓冲：二级缓冲
- 循环缓冲
- 缓冲池

## IO软件

- 用户级别：中间层，屏蔽了底层硬件
- 设备驱动程序：设备驱动程序通常又称为设备处理程序，它是I/O进程与设备控制器之间的通信程序

## 设备分配

### 相关数据结构

- 设备控制表 DCT
- 控制器控制表、通道控制表与系统设备表

### SPOOLing技术

- SPOOLing技术是对脱机输入、输出系统的模拟。相应地，SPOOLing系统必须建立在具有多道程序功能的操作系统上，而且还应有高速随机外存的支持，这通常是采用磁盘存储技术

## 磁盘存储器的管理

### 数据的组织与格式

- 磁道：每条磁道上可存储二进制位数相同
- 扇区：每条磁道又被逻辑上划分成若干个扇区

### 磁盘调度

- 先来先服务
- 最短寻道优先：要求访问的磁道与当前磁头所在的磁道距离最近，以使每次的寻道时间最短（局部最优）
- 扫描算法：该算法不仅考虑到欲访问的磁道与当前磁道间的距离，更优先考虑的是磁头当前的移动方向
- 循环扫描：扫描算法的升级，达到另外一端之后原路返回

### 提高磁盘IO速度的方法

- 提前读
- 延迟写
- 优化物理块布局
- 虚拟盘（利用内存模拟磁盘，也叫RAM盘）

### 廉价磁盘冗余阵列

# 文件管理

## 数据和文件系统

### 文件、记录、数据项

- 在文件系统中，数据项是最低级的数据组织形式
  - 基本数据项
  - 组合数据项：基本数据项的组合
- 记录：一组相关数据项的集合，用于描述一个对象在某方面的属性
- 文件：文件是指由创建者所定义的、具有文件名的一组相关元素的集合

## 文件的逻辑结构

- 有结构文件
- 无结构文件：源程序、可执行文件等

## 外存分配模式

- 连续分配
- 链接分配

## 目录管理

### 文件控制块

- 基本信息
  - 文件名
  - 物理位置
  - 文件逻辑结构
  - 文件物理结构
- 存取控制信息
  - 存取权限

- 使用信息
  - 文件创建时间
  - 最后一次修改时间

### 索引结点

- 使文件描述信息单独形成一个称为索引结点的数据结构，简称为i结点

## 文件存储空间的管理

### 空闲表法

### 空闲链表法

### 位示图法

### 成组链接法

## 文件共享与文件保护

- 共享：引用索引结点

## 数据一致性控制

- 事务
- 检查点

# 操作系统接口

# 网络操作系统

# 操作系统安全性

# UNIX系统内核结构

